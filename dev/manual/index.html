<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Manual · Anneal.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/extra_styles.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="Anneal.jl logo"/></a><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>Manual</a><ul class="internal"><li><a class="tocitem" href="#Introduction"><span>Introduction</span></a></li><li><a class="tocitem" href="#Defining-a-new-sampler-interface"><span>Defining a new sampler interface</span></a></li><li class="toplevel"><a class="tocitem" href="#Model-Mapping"><span>Model Mapping</span></a></li><li class="toplevel"><a class="tocitem" href="#Automatic-Tests"><span>Automatic Tests</span></a></li></ul></li><li><a class="tocitem" href="../examples/">Examples</a></li><li><a class="tocitem" href="../samplers/">Samplers</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Manual</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Manual</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/psrenergy/Anneal.jl/blob/master/docs/src/manual.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Manual"><a class="docs-heading-anchor" href="#Manual">Manual</a><a id="Manual-1"></a><a class="docs-heading-anchor-permalink" href="#Manual" title="Permalink"></a></h1><h2 id="Introduction"><a class="docs-heading-anchor" href="#Introduction">Introduction</a><a id="Introduction-1"></a><a class="docs-heading-anchor-permalink" href="#Introduction" title="Permalink"></a></h2><p>The core idea behind this package is to provide a toolbox for developing and integrating <a href="https://en.wikipedia.org/wiki/Quadratic_unconstrained_binary_optimization">QUBO</a> sampling tools with the <a href="https://jump.dev">JuMP</a> mathematical programming environment. Appart from the few couple exported utility engines, Anneal.jl is inherently about extensions, which is achieved by implementing most of the <a href="https://jump.dev/MathOptInterface.jl">MOI</a> requirements, leaving only the essential for the developer.</p><h3 id="QUBO"><a class="docs-heading-anchor" href="#QUBO">QUBO</a><a id="QUBO-1"></a><a class="docs-heading-anchor-permalink" href="#QUBO" title="Permalink"></a></h3><p>An optimization problem is in its QUBO form if it is written as</p><p class="math-container">\[\begin{array}{rl}
           \min &amp; \alpha \left[ \mathbf{x}&#39;\mathbf{Q}\,\mathbf{x} + \mathbf{\ell}&#39;\mathbf{x} + \beta \right] \\
    \text{s.t.} &amp; \mathbf{x} \in S \cong \mathbb{B}^{n}
\end{array}\]</p><p>with linear terms <span>$\mathbf{\ell} \in \mathbb{R}^{n}$</span> and quadratic <span>$\mathbf{Q} \in \mathbb{R}^{n \times n}$</span>. <span>$\alpha, \beta \in \mathbb{R}$</span> are, respectively, the scaling and offset factors.</p><p>The MOI-JuMP optimizers defined using the <code>Anneal.AbstractSampler{T} &lt;: MOI.AbstractOptimizer</code> interface only support models given in the QUBO form. <em>Anneal.jl</em> employs <a href="https://github.com/psrenergy/QUBOTools.jl">QUBOTools</a> on many tasks involving data management and querying. It is worth taking a look at <a href="https://psrenergy.github.io/QUBOTools.jl">QUBOTool&#39;s docs</a>.</p><h2 id="Defining-a-new-sampler-interface"><a class="docs-heading-anchor" href="#Defining-a-new-sampler-interface">Defining a new sampler interface</a><a id="Defining-a-new-sampler-interface-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-a-new-sampler-interface" title="Permalink"></a></h2><h3 id="Showcase"><a class="docs-heading-anchor" href="#Showcase">Showcase</a><a id="Showcase-1"></a><a class="docs-heading-anchor-permalink" href="#Showcase" title="Permalink"></a></h3><p>Before explaining in detail how to use this package, it&#39;s good to list a few examples for the reader to grasp. Below, there are links to the files where the actual interfaces are implemented, including thin wrappers, interfacing with Python and Julia implementations of common algorithms and heuristics.</p><table><tr><th style="text-align: left">Project</th><th style="text-align: left">Source Code</th></tr><tr><td style="text-align: left"><a href="https://github.com/psrenergy/DWaveNeal.jl">DWaveNeal.jl</a></td><td style="text-align: left"><a href="https://github.com/psrenergy/DWaveNeal.jl/blob/main/src/DWaveNeal.jl">DWaveNeal</a></td></tr><tr><td style="text-align: left"><a href="https://github.com/psrenergy/IsingSolvers.jl">IsingSolvers.jl</a></td><td style="text-align: left"><a href="https://github.com/psrenergy/IsingSolvers.jl/blob/main/src/solvers/greedy_descent.jl">GreedyDescent</a></td></tr><tr><td style="text-align: left"></td><td style="text-align: left"><a href="https://github.com/psrenergy/IsingSolvers.jl/blob/main/src/solvers/ilp.jl">ILP</a></td></tr><tr><td style="text-align: left"></td><td style="text-align: left"><a href="https://github.com/psrenergy/IsingSolvers.jl/blob/main/src/solvers/mcmc_random.jl">MCMCRandom</a></td></tr><tr><td style="text-align: left"><a href="https://github.com/psrenergy/QuantumAnnealingInterface.jl">QuantumAnnealingInterface.jl</a></td><td style="text-align: left"><a href="https://github.com/psrenergy/QuantumAnnealingInterface.jl/blob/main/src/QuantumAnnealingInterface.jl">QuantumAnnealingInterface</a></td></tr></table><h3 id="The-[@anew](@id-anew)-macro"><a class="docs-heading-anchor" href="#The-[@anew](@id-anew)-macro">The <a href="@id anew"><code>@anew</code></a> macro</a><a id="The-[@anew](@id-anew)-macro-1"></a><a class="docs-heading-anchor-permalink" href="#The-[@anew](@id-anew)-macro" title="Permalink"></a></h3><p><code>Anneal.@anew</code> is available to speed up the interface setup process. This mechanism was created to reach the majority of the target audience, that is, researchers interested in integrating their QUBO/Ising samplers in a common optimization ecossystem.</p><article class="docstring"><header><a class="docstring-binding" id="Anneal.@anew" href="#Anneal.@anew"><code>Anneal.@anew</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia hljs">@anew(expr)</code></pre><p>The <code>@anew</code> macro receives a <code>begin ... end</code> block with an attribute definition on each of the block&#39;s statements.</p><p>All attributes must be presented as an assignment to the default value of that attribute. To create a MathOptInterface optimizer attribute, an identifier must be present on the left hand side. If a solver-specific, raw attribute is desired, its name must be given as a string, e.g. between double quotes. In the special case where an attribute could be accessed in both ways, the identifier must be followed by the parenthesised raw attribute string. In any case, the attribute type can be specified typing the type assertion operator <code>::</code> followed by the type itself just before the equal sign.</p><p>For example, a list of the valid syntax variations for the <em>number of reads</em> attribute follows:     - <code>&quot;num_reads&quot; = 1_000</code>     - <code>&quot;num_reads&quot;::Integer = 1_000</code>     - <code>NumberOfReads = 1_000</code>     - <code>NumberOfReads::Integer = 1_000</code>     - <code>NumberOfReads[&quot;num_reads&quot;] = 1_000</code>     - <code>NumberOfReads[&quot;num_reads&quot;]::Integer = 1_000</code></p><p>Example</p><pre><code class="nohighlight hljs">Anneal.@anew Optimizer begin
    name = &quot;Super Sampler&quot;
    sense = :max
    domain = :spin
    version = v&quot;1.0.2&quot;
    attributes = begin
        NumberOfReads[&quot;num_reads]::Integer = 1_000
        SuperAttribute[&quot;super_attr&quot;] = nothing
    end
end</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/psrenergy/Anneal.jl/blob/bc48f2948913e7b43e83ce2cfafbfd1e23582028/src/interface/automatic/macros.jl#L278-L306">source</a></section></article><p>Inside a module scope for the new interface, one should call the <a href="@ref anew"><code>Anneal.@anew</code></a> macro, specifying the solver&#39;s attributes as described in the macro&#39;s docs. The second and last step is to define the <code>Anneal.sample(::Optimizer)</code> method, that must return a <a href="@ref sampleset"><code>Anneal.SampleSet</code></a>.</p><p>Using it might be somehow restrictive in comparison to the regular <a href="https://jump.dev/MathOptInterface.jl/stable/tutorials/implementing/">JuMP/MOI Solver Interface workflow</a>. Yet, our guess is that most of this package&#39;s users are not considering going deeper into the MOI internals that soon.</p><h3 id="[@anew](@ref-anew-macro)-example"><a class="docs-heading-anchor" href="#[@anew](@ref-anew-macro)-example"><a href="@ref anew-macro"><code>@anew</code></a> example</a><a id="[@anew](@ref-anew-macro)-example-1"></a><a class="docs-heading-anchor-permalink" href="#[@anew](@ref-anew-macro)-example" title="Permalink"></a></h3><p>The following example is intended to illustrate the usage of the macro, showing how simple it should be to implement a wrapper for a sampler implemented in another language such as C or C++.</p><pre><code class="language-julia hljs">module SuperSampler
    using Anneal

    Anneal.@anew Optimizer begin
        name    = &quot;Super Sampler&quot;
        sense   = :max
        domain  = :spin
        version = v&quot;1.0.2&quot;
        attributes = begin
            SuperAttribute::String = &quot;super&quot;
            NumberOfReads[&quot;num_reads&quot;]::Integer = 1_000
        end
    end

    model = Model(SuperSampler.Optimizer)

    @variable(model, x[1:n], Bin)
    @objective(model, Min, x&#39; * Q * x)

    function Anneal.sample(sampler::Optimizer{T}) where {T}
        # ~ Is your annealer running on the Ising Model? Have this:
        h, J, u, v = Anneal.ising(
            sampler,
            Vector, # Here we opt for a sparse, vector representation
        )

        n = MOI.get(sampler, MOI.NumberOfVariables())

        # ~ Retrieve Attributes ~ #
        num_reads = MOI.get(sampler, NumberOfReads())
        @assert num_reads &gt; 0

        super_attr = MOI.get(sampler, SuperAttribute())
        @assert super_attr ∈ (&quot;super&quot;, &quot;ultra&quot;, &quot;mega&quot;)    

        # ~*~ Timing Information ~*~ #
        time_data = Dict{String,Any}()

        # ~*~ Run Algorithm ~*~ #
        result = @timed Vector{Int}[
            super_sample(h, J, u, v; attr=super_attr)
            for _ = 1:num_reads
        ]
        states = result.value

        # ~*~ Record Time ~*~ #
        time_data[&quot;effective&quot;] = result.time

        metadata = Dict{String,Any}(
            &quot;time&quot;   =&gt; time_data,
            &quot;origin&quot; =&gt; &quot;Super Sampling method&quot;
        )

        # ~ Here some magic happens:
        #   By providing the sampler and a vector of states,
        #   Anneal.jl computes the energy and organizes your
        #   solutions automatically, following the variable
        #   domain conventions specified previously.
        return Anneal.SampleSet{T}(sampler, states, metadata)
    end

    function super_sample(h, J, u, v; super_attr, kws...)
        return ccall(
            :super_sample,
            Vector{Int},
            (
                Ptr{Cdouble},
                Ptr{Cdouble},
                Ptr{Cdouble},
                Ptr{Cdouble},
                Cint,
                Cstring,
            ),
            h,
            J,
            u,
            v,
            super_attr,
        )
    end
end</code></pre><h3 id="Walkthrough"><a class="docs-heading-anchor" href="#Walkthrough">Walkthrough</a><a id="Walkthrough-1"></a><a class="docs-heading-anchor-permalink" href="#Walkthrough" title="Permalink"></a></h3><p>Now, it&#39;s time to go through the example in greater detail. First of all, the entire work must be done within a module.</p><pre><code class="language-julia hljs">module SuperSampler
    using Anneal</code></pre><p>By provding the <code>using Anneal</code> statement, very little will be dumped into the namespace apart from the <code>MOI = MathOptInterface</code> constant. MOI&#39;s methods will soon be very important to access our optimizer&#39;s attributes.</p><pre><code class="language-julia hljs">Anneal.@anew Optimizer begin
    name    = &quot;Super Sampler&quot;
    sense   = :max
    domain  = :spin
    version = v&quot;1.0.2&quot;
    attributes = begin
        SuperAttribute::String = &quot;super&quot;
        NumberOfReads[&quot;num_reads&quot;]::Integer = 1_000
    end
end</code></pre><p>The first parameter in the <code>@anew</code> call is the optimizer&#39;s identifier. It defaults to <code>Optimizer</code> and, in this case, is responsible for defining the <code>Optimizer{T} &lt;: MOI.AbstractOptimizer</code> struct. A <code>begin...end</code> block comes next, with a few key-value pairs.</p><div class="admonition is-info"><header class="admonition-header">Info</header><div class="admonition-body"><p>Our solver, when deployed to be used within JuMP, will probably have its users to follow the usual construct:</p><pre><code class="language-julia hljs">using JuMP
using SuperSampler

model = Model(SuperSampler.Optimizer)</code></pre></div></div><p>The solver <code>name</code> must be a string, and will be used as the return value for <a href="https://jump.dev/MathOptInterface.jl/stable/reference/models/#MathOptInterface.SolverName"><code>MOI.get(::Optimizer, ::MOI.SolverName())</code></a>.</p><pre><code class="language-julia hljs">name = &quot;Super Sampler&quot;</code></pre><p>The <code>sense</code> and <code>domain</code> values indicate how our new solvers expect its models to be presented and, even more importantly, how the resulting samples should be interpreted. Their values must be either <code>:min</code> or <code>:max</code> and <code>:boll</code> or <code>:spin</code>, respectively. Strings, symbols and literals are supported as input for these fields.</p><pre><code class="language-julia hljs">sense  = :max
domain = :spin</code></pre><p>The other metadata entry is the <code>version</code> assignment, which is returned by <a href="https://jump.dev/MathOptInterface.jl/stable/reference/models/#MathOptInterface.SolverVersion"><code>MOI.get(::Optimizer, ::MOI.SolverVersion())</code></a>. In order to consistently support <a href="https://semver.org/">semantic versioning</a> it is required that the version number comes as a <em>v-string</em> e.g. <code>v&quot;major.minor.patch&quot;</code>.</p><pre><code class="language-julia hljs">version = v&quot;1.0.2&quot;</code></pre><h1 id="Model-Mapping"><a class="docs-heading-anchor" href="#Model-Mapping">Model Mapping</a><a id="Model-Mapping-1"></a><a class="docs-heading-anchor-permalink" href="#Model-Mapping" title="Permalink"></a></h1><h1 id="Automatic-Tests"><a class="docs-heading-anchor" href="#Automatic-Tests">Automatic Tests</a><a id="Automatic-Tests-1"></a><a class="docs-heading-anchor-permalink" href="#Automatic-Tests" title="Permalink"></a></h1><article class="docstring"><header><a class="docstring-binding" id="Anneal.test" href="#Anneal.test"><code>Anneal.test</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">test(optimizer::Type{S}; examples::Bool=false) where {S&lt;:AbstractSampler}
test(config!::Function, optimizer::Type{S}; examples::Bool=false) where {S&lt;:AbstractSampler}</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/psrenergy/Anneal.jl/blob/bc48f2948913e7b43e83ce2cfafbfd1e23582028/src/test/test.jl#L8-L11">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../examples/">Examples »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Saturday 7 January 2023 03:38">Saturday 7 January 2023</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
