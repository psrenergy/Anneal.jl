<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Manual · Anneal.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.044/juliamono.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/extra_styles.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="Anneal.jl logo"/></a><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>Manual</a><ul class="internal"><li><a class="tocitem" href="#Introduction"><span>Introduction</span></a></li><li><a class="tocitem" href="#Defining-a-new-sampler-interface"><span>Defining a new sampler interface</span></a></li></ul></li><li><a class="tocitem" href="../examples/">Examples</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Manual</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Manual</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/psrenergy/Anneal.jl/blob/master/docs/src/manual.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Manual"><a class="docs-heading-anchor" href="#Manual">Manual</a><a id="Manual-1"></a><a class="docs-heading-anchor-permalink" href="#Manual" title="Permalink"></a></h1><h2 id="Introduction"><a class="docs-heading-anchor" href="#Introduction">Introduction</a><a id="Introduction-1"></a><a class="docs-heading-anchor-permalink" href="#Introduction" title="Permalink"></a></h2><p>The core idea behind this package is to provide a toolbox for developing and integrating QUBO annealing/sampling tools with the <a href="https://jump.dev">JuMP</a> mathematical programming environment. Appart from the few couple bundled engines, Anneal.jl is inherently about extensions, which is achieved by implementing most of the <a href="https://jump.dev/MathOptInterface.jl">MOI</a> requirements, leaving only the essential for the developer.</p><p>The annealers and samplers defined via the <code>AbstractSampler{T}</code> interface only support models given in a QUBO form, as explained below.</p><h3 id="QUBO"><a class="docs-heading-anchor" href="#QUBO">QUBO</a><a id="QUBO-1"></a><a class="docs-heading-anchor-permalink" href="#QUBO" title="Permalink"></a></h3><p>An optimization problem is in its QUBO form if it is written as</p><p class="math-container">\[\begin{array}{rl}
    \min &amp; \mathbf{x}^{\intercal} \mathbf{Q}\, \mathbf{x} + c \\
    \text{s.t.} &amp; \mathbf{x} \in \mathbb{B}^{n}
\end{array}\]</p><p>where <span>$\mathbf{Q} \in \mathbb{R}^{n}$</span> is a symmetric matrix and <span>$c \in \mathbb{R}$</span> the constant offset.</p><p>In terms of Julia&#39;s data structures, we define a <em>QUBO Normal Form</em> (NQF) with a triplet</p><pre><code class="language-julia hljs">(x::Dict{VI, Union{Int, Nothing}}, Q::Dict{Tuple{Int, Int}, T}, c::T)</code></pre><p>where <span>$x$</span> provides a mapping between each MathOptInterface&#39;s <code>VariableIndex</code> and the corresponding integer index in <code>Q</code>.</p><p>Even though only QUBO formulations are supported as input, Anneal provides internal tools for working with Ising Model instances since many samplers rely on it. Model validation and trivial QUBO/Insing conversion is made using the functions below.</p><article class="docstring"><header><a class="docstring-binding" id="Anneal.isqubo" href="#Anneal.isqubo"><code>Anneal.isqubo</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">isqubo(model::MOI.ModelLike)</code></pre><p>Tells if a given model is ready to be interpreted as a QUBO model.</p><p>For it to be true, a few conditions must be met:</p><ol><li>All variables must be binary (<code>MOI.VariableIndex ∈ MOI.ZeroOne</code>)</li><li>No other constraints are allowed</li><li>The objective function must be of type <code>MOI.ScalarQuadraticFunction</code>, <code>MOI.ScalarAffineFunction</code> or <code>MOI.VariableIndex</code></li><li>The objective sense must be either <code>MOI.MIN_SENSE</code> or <code>MOI.MAX_SENSE</code></li></ol></div><a class="docs-sourcelink" target="_blank" href="https://github.com/psrenergy/Anneal.jl/blob/3814e28cc0404d713c02bbea73c73eb9e753b357/src/tools.jl#L1-L11">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Anneal.qubo_normal_form" href="#Anneal.qubo_normal_form"><code>Anneal.qubo_normal_form</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">qubo_normal_form(model::MOI.ModelLike)
qubo_normal_form(T::Type, model::MOI.ModelLike)</code></pre><p>Returns a triple <span>$(x, Q, c)$</span> where:</p><ul><li><code>x::Dict{MOI.VariableIndex, Union{Int, Nothing}}</code> maps each of the model&#39;s variables to an integer index, to be used when interacting with <code>Q</code>.</li><li><code>Q::Dict{Tuple{Int, Int}, T}</code> is a sparse representation of the QUBO Matrix.</li><li><code>c::T</code> is the constant term associated with the problem.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/psrenergy/Anneal.jl/blob/3814e28cc0404d713c02bbea73c73eb9e753b357/src/tools.jl#L52-L60">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Anneal.ising_normal_form" href="#Anneal.ising_normal_form"><code>Anneal.ising_normal_form</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">ising_normal_form(model::MOI.ModelLike)
ising_normal_form(T::Type, model::MOI.ModelLike)
ising_normal_form(x::Dict{VI, Union{Int, Nothing}}, Q::Dict{Tuple{Int, Int}, T}, c::T) where {T}</code></pre><p>Returns a quadruple <span>$(s, h, J, c)$</span> where:</p><ul><li><code>s::Dict{MOI.VariableIndex, Union{Int, Nothing}}</code> maps each of the model&#39;s variables to an integer index, to be used when interacting with <span>$h$</span> and <span>$J$</span>.</li><li><code>h::Dict{Int, T}</code> is a sparse vector for the linear terms of the Ising Model.</li><li><code>J::Dict{Tuple{Int, Int}, T}</code> is a sparse representation of the quadratic magnetic interactions.</li><li><code>c::T</code> is the constant term associated with the problem.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/psrenergy/Anneal.jl/blob/3814e28cc0404d713c02bbea73c73eb9e753b357/src/tools.jl#L142-L152">source</a></section></article><h2 id="Defining-a-new-sampler-interface"><a class="docs-heading-anchor" href="#Defining-a-new-sampler-interface">Defining a new sampler interface</a><a id="Defining-a-new-sampler-interface-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-a-new-sampler-interface" title="Permalink"></a></h2><p>The <code>Anneal.@anew</code> macro is available to speed up the interface setup process.</p><article class="docstring"><header><a class="docstring-binding" id="Anneal.@anew" href="#Anneal.@anew"><code>Anneal.@anew</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia hljs">    @anew(expr)

The `@anew` macro receives a `begin ... end` block with an attribute definition on each of the block&#39;s statements.

All attributes must be presented as an assignment to the default value of that attribute. To create a MathOptInterface optimizer attribute, an identifier must be present on the left hand side. If a solver-specific, raw attribute is desired, its name must be given as a string, e.g. between double quotes. In the special case where an attribute could be accessed in both ways, the identifier must be followed by the parenthesised raw attribute string. In any case, the attribute type can be specified typing the type assertion operator `::` followed by the type itself just before the equal sign.

For example, a list of the valid syntax variations for the *number of reads* attribute follows:
    - &quot;num_reads&quot; = 1_000
    - &quot;num_reads&quot;::Integer = 1_000
    - NumberOfReads = 1_000
    - NumberOfReads::Integer = 1_000
    - NumberOfReads(&quot;num_reads&quot;) = 1_000
    - NumberOfReads(&quot;num_reads&quot;)::Integer = 1_000</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/psrenergy/Anneal.jl/blob/3814e28cc0404d713c02bbea73c73eb9e753b357/src/macros.jl#L5-L21">source</a></section></article><p>Inside a module scope for the new interface, one should call the <code>Anneal.@anew</code> macro, specifying the solver&#39;s attributes as described in the macro&#39;s docs. One must also define <code>MOI.get</code> methods for the <code>MOI.SolverName</code>, <code>MOI.RawSolver</code> and <code>MOI.SolverVersion</code> attributes. The last and most important step is to define the <code>Anneal.sample</code> method, which returns both a vector with every sample and also the sampling time. The whole standard definition is described in the next example.</p><pre><code class="language-julia hljs">module SuperAnnealer
    using Anneal

    Anneal.@anew begin
        NumberOfReads::Integer = 100
        SuperAttribute::Any = nothing
    end # This will define Optimizer{T} &lt;: MOI.AbstractOptimizer

    # -*- MathOptInterface -*-
    function MOI.get(::Optimizer, MOI.SolverName)
        &quot;Super Annealer&quot;
    end

    function MOI.get(::Optimizer, MOI.SolverVersion)
        v&quot;0.1.0&quot; # Version strings are welcome!
    end

    function MOI.get(sampler::Optimizer, MOI.RawSolver)
        # Usually the sampler itself, since we are prtty much low-level here.
        # If you call another optimizer under the hood, you might want to return it.
        sampler 
    end

    function Anneal.sample(sampler::Optimizer)
        # Is your annealer running on the Ising Model? Have this:
        s, h, J, c = Anneal.ising_normal_form(sampler.x, sampler.Q, sampler.c)

        n = MOI.get(sampler, NumberOfReads())
        attr = MOI.get(sampler, SuperAttribute())

        t0 = time()
        results = [super_sample(h, J, attr) for i = 1:n]
        t1 = time()

        return (results, t1 - t0)
    end
end</code></pre><p>Type assertion for <code>Anneal.sample</code>&#39;s return can be done using the <code>::Tuple{Anneal.SamplerResults, Float64}</code> query.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../examples/">Examples »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.18 on <span class="colophon-date" title="Sunday 29 May 2022 20:23">Sunday 29 May 2022</span>. Using Julia version 1.6.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
